<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMI PLC Interface - Auger Machine with Filling Visualization</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Animate.css for animations -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    padding: 20px 0;
}
.container {
    max-width: 1100px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    padding: 25px;
    margin-top: 20px;
    border: 1px solid rgba(0, 0, 0, 0.1);
}
.header {
    border-bottom: 2px solid #eee;
    padding-bottom: 15px;
    margin-bottom: 20px;
}
.numeric-display {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    background: #f8f9fa;
    border: 1px solid #ced4da;
    border-radius: 5px;
    padding: 0.375rem 0.75rem;
}
.btn-toggle {
    min-width: 80px;
}
.btn-action {
    transition: all 0.3s ease;
    margin: 5px;
    min-width: 120px;
}
.btn-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}
.btn-on {
    background-color: #28a745;
    color: white;
}
.status-indicator {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
    background-color: #dc3545;
}
.status-active {
    background-color: #28a745;
    box-shadow: 0 0 10px #28a745;
}
.status-section {
    background-color: rgba(0, 0, 0, 0.03);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
}
.rotating {
    animation: rotate 2s linear infinite;
}
@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
.pulsing {
    animation: pulse 1.5s ease infinite;
}
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}
.input-group-text {
    min-width: 120px;
    justify-content: flex-start;
}
.footer {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 2px solid #eee;
}
#operationStatus {
    font-weight: bold;
    font-size: 1.1rem;
    color: #6c757d;
}

/* Filling Visualization Styles */
.machine-visualization {
    height: 450px;
    background-color: #f8f9fa;
    border-radius: 10px;
    border: 2px solid #dee2e6;
    position: relative;
    overflow: hidden;
}
.hopper {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 120px;
    background-color: #6c757d;
    clip-path: polygon(0 0, 100% 0, 80% 100%, 20% 100%);
    z-index: 2;
}
.hopper-material {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 160px;
    height: 80px;
    background-color: #e9c46a;
    clip-path: polygon(0 0, 100% 0, 80% 100%, 20% 100%);
    z-index: 3;
}
.auger-housing {
    position: absolute;
    top: 120px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 180px;
    background-color: #495057;
    border-radius: 10px;
    z-index: 1;
}
.auger {
    position: absolute;
    top: 130px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 160px;
    background: repeating-linear-gradient(
        0deg,
        #adb5bd,
        #adb5bd 10px,
        #868e96 10px,
        #868e96 20px
    );
    border-radius: 5px;
    z-index: 2;
}
.stirrer {
    position: absolute;
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 20px;
    z-index: 4;
}
.stirrer-arm {
    position: absolute;
    width: 120px;
    height: 10px;
    background-color: #343a40;
    border-radius: 5px;
}
.stirrer-arm:nth-child(1) {
    transform: rotate(0deg);
}
.stirrer-arm:nth-child(2) {
    transform: rotate(90deg);
}
.bag {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    width: 140px;
    height: 0;
    background-color: rgba(233, 196, 106, 0.8);
    border: 2px solid #ced4da;
    border-bottom: none;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    transition: height 0.5s linear;
    z-index: 3;
}
.bag-outline {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    width: 140px;
    height: 180px;
    border: 2px dashed #adb5bd;
    border-bottom: none;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    z-index: 2;
}
.platform {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 30px;
    background-color: #495057;
    border-radius: 5px;
    z-index: 2;
}
.filling-active .auger {
    animation: rotate 1s linear infinite;
}
.stirring-active .stirrer {
    animation: rotate 3s linear infinite;
}
.material-flow {
    position: absolute;
    top: 280px;
    left: 50%;
    transform: translateX(-50%);
    width: 10px;
    height: 0;
    background-color: #e9c46a;
    opacity: 0;
    transition: all 0.3s;
    z-index: 2;
}
.weight-display {
    position: absolute;
    bottom: 10px;
    right: 20px;
    background-color: #212529;
    color: #28a745;
    font-family: 'Digital-7', monospace;
    font-size: 24px;
    padding: 10px 15px;
    border-radius: 5px;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
    z-index: 5;
}
.weight-label {
    font-size: 14px;
    color: #adb5bd;
}
.complete-indicator {
    position: absolute;
    bottom: 10px;
    left: 20px;
    font-size: 14px;
    color: #28a745;
    font-weight: bold;
    padding: 5px 10px;
    border-radius: 5px;
    background-color: rgba(40, 167, 69, 0.1);
    border: 1px solid #28a745;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 5;
}
.digital-display {
    background-color: #212529;
    color: #20c997;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    padding: 10px;
    border-radius: 5px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    text-align: center;
}
.auger-speed-indicator, .stir-speed-indicator {
    height: 20px;
    background-color: #e9ecef;
    border-radius: 10px;
    margin-top: 5px;
    overflow: hidden;
}
.speed-value {
    height: 100%;
    background-color: #20c997;
    width: 0%;
    transition: width 0.5s;
}
.settings-panel {
    background-color: #f8f9fa;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.nav-tabs .nav-link.active {
    font-weight: bold;
    border-bottom: 3px solid #0d6efd;
}
.tab-pane {
    padding: 20px 0;
}
#cycleProgress {
    height: 10px;
}
.tablet-frame {
    border: 15px solid #343a40;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    padding: 0;
    overflow: hidden;
    max-width: 1100px;
    margin: 0 auto;
}
.tablet-header {
    background-color: #343a40;
    padding: 5px 15px;
    display: flex;
    justify-content: space-between;
    color: white;
}
.tablet-icons {
    display: flex;
    gap: 15px;
}
.help-badge {
    position: fixed;
    right: 20px;
    bottom: 20px;
    background-color: #0d6efd;
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 1000;
}
.help-badge:hover {
    background-color: #0b5ed7;
    transform: scale(1.05);
}
.modal-content {
    border-radius: 15px;
}
.modal-header {
    background-color: #f8f9fa;
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
}
    </style>
</head>
<body>
    <div class="help-badge animate__animated animate__pulse animate__infinite" data-bs-toggle="modal" data-bs-target="#helpModal">
        <i class="fas fa-question"></i>
    </div>

    <div class="container-fluid tablet-frame animate__animated animate__fadeIn">
        <div class="tablet-header">
            <div class="time" id="currentTime">14:25:30</div>
            <div class="tablet-icons">
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-three-quarters"></i>
            </div>
        </div>
        <div class="container-fluid p-0">
            <ul class="nav nav-tabs mt-2" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="main-tab" data-bs-toggle="tab" data-bs-target="#main" type="button" role="tab" aria-controls="main" aria-selected="true">
                        <i class="fas fa-home me-2"></i>Main
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="false">
                        <i class="fas fa-cog me-2"></i>Settings
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab" aria-controls="data" aria-selected="false">
                        <i class="fas fa-chart-line me-2"></i>Data
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button" role="tab" aria-controls="logs" aria-selected="false">
                        <i class="fas fa-list me-2"></i>Logs
                    </button>
                </li>
            </ul>
            
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="main" role="tabpanel" aria-labelledby="main-tab">
                    <div class="header text-center">
                        <h2 class="mb-3"><i class="fas fa-cogs me-2"></i> Auger Machine Control</h2>
                        <div class="alert alert-info" role="alert" id="operationStatus">
                            System Ready - Waiting for Commands
                        </div>
                        <div class="progress mb-2" id="cycleProgress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-5">
                            <div class="machine-visualization" id="machineVis">
                                <div class="hopper"></div>
                                <div class="hopper-material"></div>
                                <div class="stirrer">
                                    <div class="stirrer-arm"></div>
                                    <div class="stirrer-arm"></div>
                                </div>
                                <div class="auger-housing"></div>
                                <div class="auger"></div>
                                <div class="material-flow" id="materialFlow"></div>
                                <div class="bag-outline"></div>
                                <div class="bag" id="bag"></div>
                                <div class="platform"></div>
                                <div class="weight-display">
                                    <div class="weight-label">WEIGHT (g)</div>
                                    <div id="weightValue">0.0</div>
                                </div>
                                <div class="complete-indicator" id="completeIndicator">
                                    <i class="fas fa-check-circle me-1"></i> COMPLETE
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-7">
                            <div class="status-section">
                                <div class="row align-items-center mb-3">
                                    <div class="col-md-4">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-calculator me-2"></i>Count</span>
                                            <input type="number" class="form-control text-end" id="prodCount" value="0" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <button class="btn btn-primary btn-action" id="modeToggle" onclick="toggleMode()">
                                            <i class="fas fa-exchange-alt me-2"></i> Manual Mode
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-tachometer-alt me-2"></i>Rate</span>
                                            <input type="number" class="form-control text-end" id="prodRate" value="12">
                                            <span class="input-group-text">Bag/min</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="status-section">
                                        <h5 class="mb-3">Auger Control</h5>
                                        <div class="d-flex align-items-center mb-3">
                                            <span class="status-indicator" id="screwIndicator"></span>
                                            <span class="me-2">Auger</span>
                                            <button class="btn btn-outline-secondary btn-toggle ms-auto" id="screwButton" onclick="toggleScrew()">OFF</button>
                                        </div>
                                        <div class="digital-display mb-2">
                                            <div>AUGER SPEED (RPM)</div>
                                            <div id="augerSpeedValue">0</div>
                                            <div class="auger-speed-indicator">
                                                <div class="speed-value" id="augerSpeedBar"></div>
                                            </div>
                                        </div>
                                        <div class="input-group mt-3">
                                            <span class="input-group-text">Weight</span>
                                            <input type="number" class="form-control text-end" id="screwWeight" value="500" step="10">
                                            <span class="input-group-text">g</span>
                                        </div>
                                        <button class="btn btn-info btn-action w-100 mt-3" onclick="setWeight()">
                                            <i class="fas fa-weight me-2"></i> Set Weight
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="status-section">
                                        <h5 class="mb-3">Stirrer Control</h5>
                                        <div class="d-flex align-items-center mb-3">
                                            <span class="status-indicator" id="stirIndicator"></span>
                                            <span class="me-2">Stirrer</span>
                                            <button class="btn btn-outline-secondary btn-toggle ms-auto" id="stirButton" onclick="toggleStir()">OFF</button>
                                        </div>
                                        <div class="digital-display mb-2">
                                            <div>STIR SPEED (RPM)</div>
                                            <div id="stirSpeedValue">0</div>
                                            <div class="stir-speed-indicator">
                                                <div class="speed-value" id="stirSpeedBar"></div>
                                            </div>
                                        </div>
                                        <div class="input-group mt-3">
                                            <span class="input-group-text">Delay</span>
                                            <input type="number" class="form-control text-end" id="autoDelay" value="2" step="0.1">
                                            <span class="input-group-text">sec</span>
                                        </div>
                                        <div class="d-flex mt-3">
                                            <button class="btn btn-primary btn-action w-50 me-2" id="stirOffBtn" onclick="stirOff()">
                                                <i class="fas fa-power-off me-2"></i> Stir OFF
                                            </button>
                                            <button class="btn btn-primary btn-action w-50" id="keepStirBtn" onclick="keepStirring()">
                                                <i class="fas fa-sync me-2"></i> Keep Stirring
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="footer">
                                <div class="row">
                                    <div class="col-md-12 text-center">
                                        <button class="btn btn-success btn-lg btn-action" onclick="startProcess()">
                                            <i class="fas fa-play me-2"></i> Start
                                        </button>
                                        <button class="btn btn-warning btn-lg btn-action" onclick="stopProcess()">
                                            <i class="fas fa-stop me-2"></i> Stop
                                        </button>
                                        <button class="btn btn-secondary btn-lg btn-action" onclick="runEmergencyStop()">
                                            <i class="fas fa-exclamation-triangle me-2"></i> E-Stop
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                    <div class="settings-panel">
                        <h4 class="mb-4"><i class="fas fa-sliders-h me-2"></i> Machine Settings</h4>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h5 class="mb-3">Auger Settings</h5>
                                <div class="mb-3">
                                    <label for="augerMaxSpeed" class="form-label">Maximum Auger Speed (RPM)</label>
                                    <input type="range" class="form-range" min="10" max="100" value="50" id="augerMaxSpeed">
                                    <div class="d-flex justify-content-between">
                                        <small>10</small>
                                        <small>50</small>
                                        <small>100</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weightFactor" class="form-label">Weight Calibration Factor</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="weightFactor" value="1.0" step="0.01" min="0.5" max="1.5">
                                        <button class="btn btn-outline-secondary" onclick="setWeightFactor()">Apply</button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="screwCycleTime" class="form-label">Screw Test Duration (sec)</label>
                                    <input type="number" class="form-control" id="screwCycleTime" value="5" min="1" max="30">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h5 class="mb-3">Stirrer Settings</h5>
                                <div class="mb-3">
                                    <label for="stirMaxSpeed" class="form-label">Maximum Stirrer Speed (RPM)</label>
                                    <input type="range" class="form-range" min="5" max="50" value="20" id="stirMaxSpeed">
                                    <div class="d-flex justify-content-between">
                                        <small>5</small>
                                        <small>20</small>
                                        <small>50</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="stirTimeAfterFill" class="form-label">Stir Time After Filling (sec)</label>
                                    <input type="number" class="form-control" id="stirTimeAfterFill" value="3" min="0" max="10">
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="autoStirSwitch" checked>
                                    <label class="form-check-label" for="autoStirSwitch">Auto-start stirrer with process</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-3">Production Settings</h5>
                                <div class="mb-3">
                                    <label for="productName" class="form-label">Product Name</label>
                                    <input type="text" class="form-control" id="productName" value="Standard Mix">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="lotNumber" class="form-label">Lot Number</label>
                                    <input type="text" class="form-control" id="lotNumber" value="LOT-2025-00382">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="targetWeight" class="form-label">Default Target Weight (g)</label>
                                    <input type="number" class="form-control" id="targetWeight" value="500">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h5 class="mb-3">System Settings</h5>
                                <div class="mb-3">
                                    <label for="autoShutdown" class="form-label">Auto Shutdown After (min)</label>
                                    <input type="number" class="form-control" id="autoShutdown" value="30" min="5" max="120">
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="soundAlertsSwitch" checked>
                                    <label class="form-check-label" for="soundAlertsSwitch">Sound Alerts</label>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="autoResetSwitch" checked>
                                    <label class="form-check-label" for="autoResetSwitch">Auto Reset Counter</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end mt-4">
                            <button class="btn btn-secondary me-2" onclick="resetDefaultSettings()">Reset to Default</button>
                            <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="data" role="tabpanel" aria-labelledby="data-tab">
                    <div class="settings-panel">
                        <h4 class="mb-4"><i class="fas fa-chart-line me-2"></i> Production Data</h4>
                        
                        <div class="alert alert-primary">
                            <i class="fas fa-info-circle me-2"></i> Production statistics for current session
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Total Bags</h5>
                                        <h2 class="display-4" id="totalBagsDisplay">0</h2>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4 mb-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Average Weight</h5>
                                        <h2 class="display-4" id="avgWeightDisplay">0<small>g</small></h2>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4 mb-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Efficiency</h5>
                                        <h2 class="display-4" id="efficiencyDisplay">0<small>%</small></h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-3">Recent Bags</h5>
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Bag #</th>
                                    <th>Time</th>
                                    <th>Weight (g)</th>
                                    <th>Deviation</th>
                                </tr>
                            </thead>
                            <tbody id="recentBagsBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane fade" id="logs" role="tabpanel">
                    <div class="settings-panel">
                        <h4 class="mb-4"><i class="fas fa-list me-2"></i> System Logs</h4>
                        
                        <div class="alert alert-secondary">
                            <i class="fas fa-clock me-2"></i> Logs for current session
                        </div>
                        
                        <div class="logs-container">
                            <ul class="list-group" id="systemLogsContainer">
                                <li class="list-group-item">
                                    <span class="log-timestamp">14:25:30</span>
                                    <span class="log-type log-info">INFO</span>
                                    <span class="log-message">System initialized</span>
                                </li>
                                <li class="list-group-item">
                                    <span class="log-timestamp">14:25:30</span>
                                    <span class="log-type log-info">INFO</span>
                                    <span class="log-message">HMI interface loaded</span>
                                </li>
                                <li class="list-group-item">
                                    <span class="log-timestamp">14:25:31</span>
                                    <span class="log-type log-info">INFO</span>
                                    <span class="log-message">Settings loaded from local storage</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="d-flex justify-content-end mt-4">
                            <button class="btn btn-secondary" onclick="clearLogs()">
                                <i class="fas fa-trash me-2"></i> Clear Logs
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel"><i class="fas fa-question-circle me-2"></i> Auger Machine Help</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h4>Auger Machine HMI Interface Guide</h4>
                    <p>This Human-Machine Interface (HMI) allows you to control an auger filling machine with visualization and monitoring capabilities.</p>
                    
                    <h5 class="mt-4">Main Controls</h5>
                    <ul>
                        <li><strong>Start Button:</strong> Begins the filling operation based on selected mode (Auto/Manual).</li>
                        <li><strong>Stop Button:</strong> Stops the current operation safely.</li>
                        <li><strong>E-Stop Button:</strong> Emergency stop - immediately halts all operations.</li>
                    </ul>
                    
                    <h5 class="mt-4">Operation Modes</h5>
                    <ul>
                        <li><strong>Manual Mode:</strong> Operator must toggle auger and stirrer manually.</li>
                        <li><strong>Auto Mode:</strong> System will automatically cycle through the fill process.</li>
                    </ul>
                    
                    <h5 class="mt-4">Settings</h5>
                    <p>The Settings tab allows you to configure machine parameters including:</p>
                    <ul>
                        <li>Auger and stirrer speeds</li>
                        <li>Weight calibration factors</li>
                        <li>Default target weights</li>
                        <li>Production information</li>
                    </ul>
                    
                    <h5 class="mt-4">Data Tab</h5>
                    <p>Provides production statistics and historical data on recent bags filled.</p>
                    
                    <h5 class="mt-4">Logs Tab</h5>
                    <p>Records all system events and actions for troubleshooting and monitoring.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="script.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
     // System State Variables
let isRunning = false;
let isAuto = false;
let screwOn = false;
let stirOn = false;
let currentWeight = 0;
let targetWeight = 500;
let totalBags = 0;
let sumWeight = 0;
let cycleProgress = 0;
let fillInterval;
let progressInterval;
let recentBags = [];
let stirSpeed = 0;
let augerSpeed = 0;
let weightFactor = 1.0;
let systemLogs = [];

// Initialization
document.addEventListener('DOMContentLoaded', () => {
    updateClock();
    setInterval(updateClock, 1000);
    document.getElementById('screwWeight').value = targetWeight;
    loadSettings();
    addSystemLog('INFO', 'System initialized');
    addSystemLog('INFO', 'HMI interface loaded');
    addSystemLog('INFO', 'Settings loaded from local storage');
    
    // Initialize speed indicators
    updateSpeedIndicators();
});

function updateClock() {
    const now = new Date();
    document.getElementById('currentTime').textContent = now.toLocaleTimeString();
}

// Control Functions
function toggleMode() {
    isAuto = !isAuto;
    const btn = document.getElementById('modeToggle');
    btn.innerHTML = `<i class="fas fa-exchange-alt me-2"></i>${isAuto ? 'Auto' : 'Manual'} Mode`;
    btn.className = `btn btn-${isAuto ? 'success' : 'primary'} btn-action`;
    addSystemLog('INFO', `Switched to ${isAuto ? 'Auto' : 'Manual'} mode`);
}

function toggleScrew() {
    screwOn = !screwOn;
    const btn = document.getElementById('screwButton');
    const indicator = document.getElementById('screwIndicator');
    
    btn.textContent = screwOn ? 'ON' : 'OFF';
    btn.className = `btn ${screwOn ? 'btn-on' : 'btn-outline-secondary'} btn-toggle`;
    indicator.classList.toggle('status-active', screwOn);
    document.getElementById('machineVis').classList.toggle('filling-active', screwOn);
    
    if(screwOn) {
        startFilling();
        setAugerSpeed(parseInt(document.getElementById('augerMaxSpeed').value));
        addSystemLog('INFO', 'Auger started');
    } else {
        stopFilling();
        setAugerSpeed(0);
        addSystemLog('INFO', 'Auger stopped');
    }
}

function toggleStir() {
    stirOn = !stirOn;
    const btn = document.getElementById('stirButton');
    const indicator = document.getElementById('stirIndicator');
    
    btn.textContent = stirOn ? 'ON' : 'OFF';
    btn.className = `btn ${stirOn ? 'btn-on' : 'btn-outline-secondary'} btn-toggle`;
    indicator.classList.toggle('status-active', stirOn);
    document.getElementById('machineVis').classList.toggle('stirring-active', stirOn);
    
    if(stirOn) {
        setStirSpeed(parseInt(document.getElementById('stirMaxSpeed').value));
        addSystemLog('INFO', 'Stirrer started');
    } else {
        setStirSpeed(0);
        addSystemLog('INFO', 'Stirrer stopped');
    }
}

function startFilling() {
    // Reset bag and indicators
    currentWeight = 0;
    document.getElementById('bag').style.height = '0';
    document.getElementById('completeIndicator').style.opacity = '0';
    
    // Show material flow
    const materialFlow = document.getElementById('materialFlow');
    materialFlow.style.height = '30px';
    materialFlow.style.opacity = '1';
    
    // Get target weight
    targetWeight = parseFloat(document.getElementById('screwWeight').value);
    
    // Start the filling animation
    fillInterval = setInterval(() => {
        if(currentWeight < targetWeight) {
            // Apply weight factor for calibration
            const increment = (targetWeight/100) * weightFactor;
            currentWeight += increment;
            updateWeightDisplay();
            
            // Update bag height (max 180px)
            const bagHeight = (currentWeight/targetWeight) * 180;
            document.getElementById('bag').style.height = `${bagHeight}px`;
        } else {
            completeFillCycle();
        }
    }, 20);
}

function updateWeightDisplay() {
    document.getElementById('weightValue').textContent = currentWeight.toFixed(1);
}

function stopFilling() {
    clearInterval(fillInterval);
    const materialFlow = document.getElementById('materialFlow');
    materialFlow.style.height = '0';
    materialFlow.style.opacity = '0';
}

function completeFillCycle() {
    clearInterval(fillInterval);
    document.getElementById('completeIndicator').style.opacity = '1';
    
    // Stop material flow
    const materialFlow = document.getElementById('materialFlow');
    materialFlow.style.height = '0';
    materialFlow.style.opacity = '0';
    
    // Update statistics
    totalBags++;
    sumWeight += currentWeight;
    updateProductionStats();
    
    addSystemLog('INFO', `Bag filled: ${currentWeight.toFixed(1)}g`);
    
    // Auto mode: wait and start next cycle
    if(isAuto) {
        const delay = parseFloat(document.getElementById('autoDelay').value) * 1000;
        setTimeout(() => {
            if(isRunning) {
                if(screwOn) toggleScrew(); // Turn off auger
                
                // Wait before starting next bag
                setTimeout(() => {
                    if(isRunning) toggleScrew(); // Turn on auger
                }, 1000);
            }
        }, delay);
    }
}

function updateProductionStats() {
    // Update display count
    document.getElementById('prodCount').value = totalBags;
    document.getElementById('totalBagsDisplay').textContent = totalBags;
    
    // Calculate average weight
    const avgWeight = totalBags > 0 ? sumWeight / totalBags : 0;
    document.getElementById('avgWeightDisplay').textContent = `${avgWeight.toFixed(1)}<small>g</small>`;
    
    // Calculate efficiency (based on production rate)
    const targetRate = parseInt(document.getElementById('prodRate').value);
    const efficiency = Math.min(100, Math.floor((totalBags / (targetRate * 5)) * 100));
    document.getElementById('efficiencyDisplay').textContent = `${efficiency}<small>%</small>`;
    
    // Save record of this bag
    recentBags.push({
        weight: currentWeight,
        time: new Date().toLocaleTimeString(),
        deviation: (currentWeight - targetWeight).toFixed(1)
    });
    
    // Keep only last 20 bags in history
    if(recentBags.length > 20) {
        recentBags.shift();
    }
    
    updateRecentBagsTable();
}

function updateRecentBagsTable() {
    const tbody = document.getElementById('recentBagsBody');
    tbody.innerHTML = '';
    
    // Display last 5 bags in reverse order
    const displayBags = recentBags.slice(-5).reverse();
    
    displayBags.forEach((bag, index) => {
        const row = document.createElement('tr');
        
        // Bag number
        const numCell = document.createElement('td');
        numCell.textContent = totalBags - index;
        row.appendChild(numCell);
        
        // Time
        const timeCell = document.createElement('td');
        timeCell.textContent = bag.time;
        row.appendChild(timeCell);
        
        // Weight
        const weightCell = document.createElement('td');
        weightCell.textContent = parseFloat(bag.weight).toFixed(1);
        row.appendChild(weightCell);
        
        // Deviation
        const devCell = document.createElement('td');
        const deviation = parseFloat(bag.deviation);
        devCell.textContent = `${deviation > 0 ? '+' : ''}${deviation}g`;
        devCell.className = deviation >= -5 && deviation <= 5 ? 'text-success' : 'text-danger';
        row.appendChild(devCell);
        
        tbody.appendChild(row);
    });
}

// System Control
function startProcess() {
    if(!isRunning) {
        isRunning = true;
        document.getElementById('operationStatus').className = 'alert alert-success';
        document.getElementById('operationStatus').textContent = 'System Running';
        startProgressBar();
        
        // Auto-start stirrer if configured
        if(document.getElementById('autoStirSwitch').checked && !stirOn) {
            toggleStir();
        }
        
        // Auto mode: start auger automatically
        if(isAuto && !screwOn) {
            toggleScrew();
        }
        
        addSystemLog('INFO', 'Process started');
    }
}

function stopProcess() {
    isRunning = false;
    document.getElementById('operationStatus').className = 'alert alert-warning';
    document.getElementById('operationStatus').textContent = 'System Stopped';
    clearInterval(progressInterval);
    
    // Stop auger if running
    if(screwOn) {
        toggleScrew();
    }
    
    addSystemLog('INFO', 'Process stopped');
}

function runEmergencyStop() {
    isRunning = false;
    
    // Stop everything
    if(screwOn) toggleScrew();
    if(stirOn) toggleStir();
    stopFilling();
    
    // Update UI
    document.getElementById('operationStatus').className = 'alert alert-danger';
    document.getElementById('operationStatus').textContent = 'EMERGENCY STOP';
    clearInterval(progressInterval);
    
    // Flash effect
    document.body.classList.add('emergency-stop');
    setTimeout(() => document.body.classList.remove('emergency-stop'), 1000);
    
    addSystemLog('ALERT', 'EMERGENCY STOP activated');
}

// Weight Functions
function setWeight() {
    const input = document.getElementById('screwWeight');
    targetWeight = parseFloat(input.value);
    if(isNaN(targetWeight) || targetWeight <= 0) {
        showToast('Invalid weight value', 'danger');
        input.value = 500;
        targetWeight = 500;
    }
    addSystemLog('INFO', `Target weight set to ${targetWeight}g`);
}

function setWeightFactor() {
    const input = document.getElementById('weightFactor');
    const newFactor = parseFloat(input.value);
    if(!isNaN(newFactor) && newFactor > 0) {
        weightFactor = newFactor;
        addSystemLog('INFO', `Weight calibration factor set to ${weightFactor}`);
    } else {
        input.value = weightFactor;
        showToast('Invalid calibration factor', 'warning');
    }
}

// Stirrer Control Functions
function stirOff() {
    if(stirOn) {
        toggleStir();
    }
}

function keepStirring() {
    if(!stirOn) {
        toggleStir();
    }
}

// Speed Control Functions
function setAugerSpeed(speed) {
    augerSpeed = speed;
    document.getElementById('augerSpeedValue').textContent = speed;
    const speedBar = document.getElementById('augerSpeedBar');
    speedBar.style.width = `${speed}%`;
}

function setStirSpeed(speed) {
    stirSpeed = speed;
    document.getElementById('stirSpeedValue').textContent = speed;
    const speedBar = document.getElementById('stirSpeedBar');
    speedBar.style.width = `${speed * 2}%`; // Scale up for better visualization (max 50)
}

function updateSpeedIndicators() {
    setAugerSpeed(screwOn ? parseInt(document.getElementById('augerMaxSpeed').value) : 0);
    setStirSpeed(stirOn ? parseInt(document.getElementById('stirMaxSpeed').value) : 0);
}

// Progress Bar
function startProgressBar() {
    cycleProgress = 0;
    const bar = document.querySelector('.progress-bar');
    clearInterval(progressInterval);
    progressInterval = setInterval(() => {
        cycleProgress = (cycleProgress + 1) % 100;
        bar.style.width = `${cycleProgress}%`;
        bar.setAttribute('aria-valuenow', cycleProgress);
    }, 100);
}

// Settings Management
function saveSettings() {
    const settings = {
        targetWeight: document.getElementById('targetWeight').value,
        augerMaxSpeed: document.getElementById('augerMaxSpeed').value,
        stirMaxSpeed: document.getElementById('stirMaxSpeed').value,
        productName: document.getElementById('productName').value,
        lotNumber: document.getElementById('lotNumber').value,
        autoShutdown: document.getElementById('autoShutdown').value,
        soundAlerts: document.getElementById('soundAlertsSwitch').checked,
        autoReset: document.getElementById('autoResetSwitch').checked,
        autoStir: document.getElementById('autoStirSwitch').checked,
        stirTimeAfterFill: document.getElementById('stirTimeAfterFill').value,
        weightFactor: document.getElementById('weightFactor').value
    };
    
    localStorage.setItem('hmiSettings', JSON.stringify(settings));
    showToast('Settings saved successfully', 'success');
    addSystemLog('INFO', 'Settings saved to local storage');
}

function loadSettings() {
    try {
        const settings = JSON.parse(localStorage.getItem('hmiSettings')) || {};
        
        // Apply settings to form elements
        document.getElementById('targetWeight').value = settings.targetWeight || 500;
        document.getElementById('augerMaxSpeed').value = settings.augerMaxSpeed || 50;
        document.getElementById('stirMaxSpeed').value = settings.stirMaxSpeed || 20;
        document.getElementById('productName').value = settings.productName || 'Standard Mix';
        document.getElementById('lotNumber').value = settings.lotNumber || 'LOT-2025-00382';
        document.getElementById('autoShutdown').value = settings.autoShutdown || 30;
        document.getElementById('soundAlertsSwitch').checked = settings.soundAlerts !== false;
        document.getElementById('autoResetSwitch').checked = settings.autoReset !== false;
        document.getElementById('autoStirSwitch').checked = settings.autoStir !== false;
        document.getElementById('stirTimeAfterFill').value = settings.stirTimeAfterFill || 3;
        document.getElementById('weightFactor').value = settings.weightFactor || 1.0;
        weightFactor = parseFloat(settings.weightFactor || 1.0);
        
        // Update target weight input
        document.getElementById('screwWeight').value = settings.targetWeight || 500;
        targetWeight = parseFloat(settings.targetWeight || 500);
    } catch (e) {
        console.error('Error loading settings:', e);
        showToast('Error loading settings', 'danger');
    }
}

function resetDefaultSettings() {
    document.getElementById('targetWeight').value = 500;
    document.getElementById('augerMaxSpeed').value = 50;
    document.getElementById('stirMaxSpeed').value = 20;
    document.getElementById('productName').value = 'Standard Mix';
    document.getElementById('lotNumber').value = 'LOT-2025-00382';
    document.getElementById('autoShutdown').value = 30;
    document.getElementById('soundAlertsSwitch').checked = true;
    document.getElementById('autoResetSwitch').checked = true;
    document.getElementById('autoStirSwitch').checked = true;
    document.getElementById('stirTimeAfterFill').value = 3;
    document.getElementById('weightFactor').value = 1.0;
    weightFactor = 1.0;
    
    showToast('Settings reset to default values', 'info');
    addSystemLog('INFO', 'Settings reset to defaults');
}

// Log Management
function addSystemLog(type, message) {
    const now = new Date();
    const timestamp = now.toLocaleTimeString();
    
    systemLogs.push({
        timestamp,
        type,
        message
    });
    
    updateSystemLogs();
}

function updateSystemLogs() {
    const container = document.getElementById('systemLogsContainer');
    
    // Keep only latest logs if too many
    if (systemLogs.length > 100) {
        systemLogs = systemLogs.slice(-100);
    }
    
    // Generate HTML for logs
    container.innerHTML = systemLogs.map(log => `
        <li class="list-group-item">
            <span class="log-timestamp">${log.timestamp}</span>
            <span class="log-type log-${log.type.toLowerCase()}">${log.type}</span>
            <span class="log-message">${log.message}</span>
        </li>
    `).join('');
    
    // Scroll to bottom
    container.scrollTop = container.scrollHeight;
}

function clearLogs() {
    systemLogs = [];
    updateSystemLogs();
    addSystemLog('INFO', 'System logs cleared');
}

// Utility Functions
function showToast(message, type = 'info') {
    // Create toast container if it doesn't exist
    let toastContainer = document.querySelector('.toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toastId = 'toast-' + Date.now();
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type}`;
    toast.id = toastId;
    toast.setAttribute('role', 'alert');
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Initialize and show the toast
    const toastInstance = new bootstrap.Toast(toast, {
        animation: true,
        autohide: true,
        delay: 3000
    });
    
    toastInstance.show();
    
    // Log notification to system logs
    if (type === 'danger' || type === 'warning') {
        addSystemLog(type === 'danger' ? 'ERROR' : 'WARNING', message);
    }
    
    // Remove from DOM after hidden
    toast.addEventListener('hidden.bs.toast', function () {
        toast.remove();
    });
}
    </script>
</body>
</html>
